"use strict";(function(){jQuery(document).ready(function(r){var a,t,n,c,l,m,s,e,i,o,p,_,u,d=null!=(s=window.wc_memberships_admin)?s:{},h=null!=(e=window.wc_memberships_mailchimp_sync_admin)?e:{},y=(i=window.typenow,null!=(o=window.pagenow)?o:""),b=!1;if("woocommerce_page_wc-settings"===y&&((p=function(){var e,s,i,t,n,c=r("#wc_memberships_mailchimp_sync_mailchimp_api_key");if(c)return t=c.val(),e=c.closest("td").find("span.description"),i='<span class="invalid-key" style="color:'+h.status_color.failure+';">&#10005;</span>',n='<span class="valid-key"   style="color:'+h.status_color.success+';">&#10004;</span>',t?(s={action:"wc_memberships_mailchimp_sync_is_api_key_valid",api_key:t,security:h.is_valid_api_key_nonce},r.post(d.ajax_url,s,function(s){return s.success?e.html(n):e.html(i)})):e.html("")})(),_=function(){var s=r("#wc_memberships_mailchimp_sync_members_opt_in_prompt_text").closest("tr"),e=r("#wc_memberships_mailchimp_sync_members_opt_in_button_text").closest("tr");return"manual"===r('input[name="wc_memberships_mailchimp_sync_members_opt_in"]:checked').val()?(s.show(),e.show()):(s.hide(),e.hide())},r('input[name="wc_memberships_mailchimp_sync_members_opt_in"]').on("change",function(s){return _()}).change(),r("#wc_memberships_mailchimp_sync_mailchimp_api_key").on("keydown",function(s){return clearTimeout(b),b=setTimeout(p,500)}),t=r("select#wc_memberships_mailchimp_sync_default_list"),n=r("#wc-memberships-mailchimp-sync-list-settings"),c=t.val(),r(document).ready(function(){return u(t.val())}),t.on("change",function(s){var e=r(this).val();if(n&&e!==c)return u(e)}),(m=function(){return r("#wc-memberships-mailchimp-sync-sync-members").on("click",function(s){var e,i,t=this;return s.preventDefault(),r(this).prop("disabled",!0),r(this).next("p").addClass("sync-result").html(h.i18n.sync_in_progress),e={action:"wc_memberships_mailchimp_sync_start_members_sync",security:h.start_members_sync},i='<span class="error" style="color:'+h.status_color.failure+';">&#10005;</span> '+h.i18n.sync_error,r.post(ajaxurl,e).done(function(s){return s.success?null!=s.data.id?setTimeout(l(s.data.id),1e5):void 0:(r("p.sync-result").html(i),r(t).prop("disabled",!1))}).fail(function(){return r(t).prop("disabled",!1),r("p.sync-result").html(i)})}),r(".tips, .help_tip, .woocommerce-help-tip").tipTip({attribute:"data-tip",fadeIn:50,fadeOut:50,delay:200})})(),u=function(e){var s,i=n.find(".list-field");if(i)return i.block({message:null,overlayCSS:{"border-radius":"3px",opacity:"0.2"}}),s={action:"wc_memberships_mailchimp_sync_update_list_settings",list_id:e,security:h.update_list_settings},r.post(d.ajax_url,s,function(s){return s.success?(c=e,n.html(s.data),r(".wc-enhanced-select").select2()):(t.val(c),console.log(s)),i&&i.unblock(),m()})},l=function(s){var e,i,t;return 0===r("p.sync-result .progress").length&&r("p.sync-result").append(' <span class="progress"></span>'),i='<span class="error"   style="color:'+h.status_color.failure+';">&#10005;</span> '+h.i18n.sync_error,t='<span class="success" style="color:'+h.status_color.success+';">&#10004;</span> '+h.i18n.sync_success,e={action:"wc_memberships_mailchimp_sync_get_members_sync_status",security:h.get_members_sync_status,job_id:s},r.post(ajaxurl,e).done(function(s){if(s.success){if("completed"!==s.data.status)return r("p.sync-result .progress").html(s.data.finished+" / "+s.data.total),setTimeout(l(s.data.id),1e5);r("p.sync-result").html(t)}else r("p.sync-result").html(i),console.log(s.data);return r("#wc-memberships-mailchimp-sync-sync-members").prop("disabled",!1)}).fail(function(){return r("#wc-memberships-mailchimp-sync-sync-members").prop("disabled",!1),r("p.sync-result").html(i)})},h.existing_sync_id&&l(h.existing_sync_id)),"wc_user_membership"===y)return(a=r("#wc-memberships-mailchimp-user-membership-details")).find("button.sync-member").on("click",function(s){var e,i,t,n,c;return s.preventDefault(),n=a.find(".syncing"),i=a.find(".sync-done"),t=a.find(".sync-error"),e=n.parent(),i.hide(),t.hide(),e.hide(),e.slideToggle(),n.fadeToggle(),c={action:"wc_memberships_mailchimp_sync_update_member",user_membership_id:parseInt(r(this).data("user-membership-id"),10),security:h.sync_member},r.post(d.ajax_url,c,function(s){return n.hide(),s.success?(i.show(),e.slideToggle(),location.reload()):(t.html(s.data),t.show(),console.log(s.data))})})})}).call(void 0);