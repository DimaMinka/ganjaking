jQuery(document).ready(function(e){"use strict";e.wc_additional_variation_images_admin={getVariationIDs:function(){var a=[];return e.each(e("#variable_product_options .woocommerce_variation"),function(){a.push(e(this).find(".upload_image .upload_image_button").prop("rel"))}),a},runSortable:function(){e.each(e("#variable_product_options .woocommerce_variation"),function(){var a=e(this).find("a.upload_image_button").prop("rel");e(this).find("ul.wc-additional-variations-images-list").sortable({update:function(){e.wc_additional_variation_images_admin.prepThumbs(a)},placeholder:"sortable-placeholder",cursor:"move"})})},prepThumbs:function(a){if(!(a.length<=0)){var i=[],t=e('#variable_product_options .woocommerce_variation a.upload_image_button[rel="'+a+'"]').parent(".upload_image");t.find("ul.wc-additional-variations-images-list li").length?(e.each(t.find("ul.wc-additional-variations-images-list li"),function(){i.push(e(this).find("a.wc-additional-variations-images-thumb").data("id"))}),t.find("input.wc-additional-variations-images-thumbs-save").val(i)):t.find("input.wc-additional-variations-images-thumbs-save").val(""),i.join(","),e("#variable_product_options").find("input").eq(0).change(),t.parents(".woocommerce_variation").eq(0).addClass("variation-needs-update")}},init:function(){var n=wc_additional_variation_images_local,a={action:"wc_additional_variation_images_load_images_ajax",ajaxAdminLoadImageNonce:wc_additional_variation_images_local.ajaxAdminLoadImageNonce,variation_ids:e.wc_additional_variation_images_admin.getVariationIDs()};e.wc_additional_variation_images_admin.getVariationIDs().length&&e.post(wc_additional_variation_images_local.ajaxurl,a,function(a){for(var i in a.images)if(a.images.hasOwnProperty(i)){var t='<h4 class="wc-additional-variation-images-title">'+n.adminTitleText+' <a href="#" class="wc-additional-variations-images-tip" data-tip="'+n.adminAddImagesTip+'">[?]</a></h4>'+a.images[i]+'<a href="#" class="add-additional-images">'+n.adminAddImagesText+"</a>";e('#variable_product_options .woocommerce_variation a.upload_image_button[rel="'+i+'"]').parents(".upload_image").find("a.wc-additional-variations-images-tip").length||e('#variable_product_options .woocommerce_variation a.upload_image_button[rel="'+i+'"]').after(t)}e(".wc-additional-variations-images-tip").tipTip({attribute:"data-tip",fadeIn:50,fadeOut:50}),e.wc_additional_variation_images_admin.runSortable()}),e("#variable_product_options .woocommerce_variation").on("click","a.add-additional-images",function(a){a.preventDefault();var i,t=e(this).parents(".upload_image").find("a.upload_image_button").prop("rel"),o=e(this).parents(".upload_image").find("ul.wc-additional-variations-images-list");(i=wp.media.frames.mediaFrame=wp.media({title:n.adminMediaTitle,button:{text:n.adminMediaAddImageText},library:{type:"image"},multiple:!0})).on("select",function(){i.state().get("selection").map(function(a){if((a=a.toJSON()).id){var i=a.sizes.thumbnail?a.sizes.thumbnail.url:a.url;o.append('<li><a href="#" class="wc-additional-variations-images-thumb" data-id="'+a.id+'"><img src="'+i+'" /><span class="overlay"></span></a></li>')}}),wp.media.model.settings.post.id=t,e.wc_additional_variation_images_admin.runSortable(),e.wc_additional_variation_images_admin.prepThumbs(t)}),i.open()}),e("#variable_product_options .woocommerce_variation").on("click","a.wc-additional-variations-images-thumb",function(a){a.preventDefault();var i=e(this).parents(".upload_image").find("a.upload_image_button").prop("rel");e(this).parent("li").remove(),e.wc_additional_variation_images_admin.prepThumbs(i)})}},e.wc_additional_variation_images_admin.init(),e("body").on("woocommerce_variations_added woocommerce_variations_loaded",function(){e.wc_additional_variation_images_admin.init()})});
