"use strict";(function(){jQuery(document).ready(function(n){function e(l){var e=l('form[name="checkout"]');return l('form[name="checkout"]').addClass("wc-checkout-add-ons-dropzone"),e.find(":input.select").each(function(e){var t,n=l(this),o=l(this).closest(".form-row").hasClass("validate-required");if(!l(this).data("select2"))return"function"==typeof(t=l(this)).select2&&t.select2({allowClear:!o,placeholder:l(this).attr("multiple")?wc_checkout_add_ons.select_placeholder_multi:wc_checkout_add_ons.select_placeholder_single}).on("select2:unselecting",function(){return l(this).data("unselecting",!0)}).on("select2:opening",function(e){if(l(this).data("unselecting"))return l(this).removeData("unselecting"),e.preventDefault()}),n.is(":focus")&&n.closest(".form-row").find(".select2-selection").focus(),l().select2}),l(function(){return l("#wc_checkout_add_ons :input").on("change",function(e){if(!l(this).hasClass("select2-search__field"))return t(e)})}),l(function(){return l("#wc_checkout_add_ons .wc-checkout-add-ons-input-file-plupload").each(function(e){var c=l(this),d=c.find(".wc-checkout-add-ons-dropzone"),s=c.find(".wc-checkout-add-ons-preview"),a=c.find(".wc-checkout-add-ons-progress"),i=c.find(".wc-checkout-add-ons-feedback"),r=c.find('input[type="hidden"]'),t=c.parents(".form-row").prop("id"),n={url:wc_checkout_add_ons.ajax_url,multipart_params:{action:"wc_checkout_add_on_upload_file",security:wc_checkout_add_ons.upload_nonce,field:t},browse_button:d[0],drop_element:d[0],multi_selection:1<wc_checkout_add_ons.max_files,filters:{max_file_size:wc_checkout_add_ons.max_file_size,mime_types:wc_checkout_add_ons.mime_types}},o=new plupload.Uploader(n);return o.init(),o.bind("Error",function(e,t){return i.html("\nError #"+t.code+": "+t.message).removeClass("hide"),a.addClass("hide")}),o.bind("FilesAdded",function(e,t){return i.html("").addClass("hide"),d.addClass("disabled"),a.removeClass("hide"),o.start()}),o.bind("UploadProgress",function(e,t){return a.find(".bar").css("width",t.percent+"%")}),o.bind("FileUploaded",function(e,t,n){var o=l.parseJSON(n.response);return o.errors?(i.html(o.errors.upload_error).removeClass("hide"),a.addClass("hide"),void d.removeClass("disabled")):(r.val(o.id).trigger("change"),s.removeClass("hide").find("a.file").prop("href",o.url).text(o.title),d.addClass("hide").removeClass("disabled"),a.addClass("hide").find(".bar").css("width",0),c.find(".moxie-shim").addClass("hide"))}),c.find("a.remove-file").on("click",function(e){return e.preventDefault(),s.addClass("hide"),d.removeClass("hide disabled"),l.ajax({type:"POST",url:wc_checkout_add_ons.ajax_url,data:{action:"wc_checkout_add_on_remove_file",security:wc_checkout_add_ons.remove_nonce,file:r.val()}}),r.val("").trigger("change"),c.find(".moxie-shim").removeClass("hide")})})})}var t=function(e){var t;return n('input[type="file"]').each(function(e){if(n(this).val())return n(this).next().val("1")}),t=n(e.target).attr("id"),n(e.target).one("focusout",function(e){return t=n(e.relatedTarget).attr("id")}),n("body").one("updated_checkout",function(){return n("#"+t).focus(),n("#wc_checkout_add_ons").unblock()}),n("#wc_checkout_add_ons").block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),n('form[name="checkout"]').find("select").each(function(e){if(n(this).hasClass("select"))return n(this).select2("destroy")}),n("body").trigger("update_checkout")};return e(n),n(document).on("updated_checkout",function(){return e(n)})})}).call(void 0);