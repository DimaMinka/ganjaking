!function(a){"use strict";a(function(){function b(b){b&&a.blockUI({message:b,baseZ:99999,overlayCSS:{background:"#fff",opacity:.6},css:{padding:"20px",zindex:"9999999",textAlign:"center",color:"#555",border:"3px solid #aaa",backgroundColor:"#fff",cursor:"wait",lineHeight:"24px"}})}function c(){var b=a("#support-conversation-wrap");a("html, body").animate({scrollTop:b.offset().top},500)}a("#support-conversations-table .conversation-view").on("click",function(d){d.preventDefault();var e=a(this).data("conversation-id"),f=a("#support-conversation-wrap");b(woocommerce_help_scout_myaccount_params.getting_conversation),a.ajax({type:"GET",url:woocommerce_help_scout_myaccount_params.ajax_url,cache:!1,dataType:"json",data:{action:"wc_help_scout_get_conversation",security:woocommerce_help_scout_myaccount_params.security,conversation_id:e},success:function(b){var d="",g=woocommerce_help_scout_myaccount_params.error;a.unblockUI(),null!==b&&""===b.error?(d+='<h3 id="support-conversation-thread-head">"'+b.subject+'":</h3>',d+='<ul id="support-conversation-thread">',a.each(b.threads,function(a,b){d+="<li>",d+="<strong>"+b.author+"</strong> <small>("+b.date+")</small>:",d+=b.message,d+="</li>"}),d+="</ul>",d+='<p><a href="#" data-conversation-id="'+e+'" data-subject="'+b.subject+'" class="button conversation-reply">'+woocommerce_help_scout_myaccount_params.reply+"</a></p>",f.empty().prepend(d),c()):(null!==b&&null!==b.error&&""!==b.error&&(g=b.error),a(".woocommerce-error",f).remove(),f.prepend('<div class="woocommerce-error">'+g+"</div>"))},error:function(){a.unblockUI(),a(".woocommerce-error",f).remove(),f.prepend('<div class="woocommerce-error">'+woocommerce_help_scout_myaccount_params.error+"</div>")}})}),a("body").on("click",".conversation-reply",function(b){b.preventDefault();var d=a(this).data("conversation-id"),e=a("#support-conversation-wrap"),f="";f+='<h3 id="support-conversation-thread-head">'+woocommerce_help_scout_myaccount_params.reply_to+' "'+a(this).data("subject")+'":</h3>',f+='<form id="support-conversation-reply" action="" method="post">',f+='<p class="form-row form-row-wide">',f+='<label for="conversation-message">'+woocommerce_help_scout_myaccount_params.message+' <span class="required">*</span></label>',f+='<textarea id="conversation-message" class="conversation-field" name="conversation_message" cols="25" rows="5"></textarea>',f+="</p>",f+='<p class="form-row">',f+='<input type="hidden" name="conversation_id" value="'+d+'" />',f+='<input type="hidden" name="user_id" value="'+woocommerce_help_scout_myaccount_params.user_id+'" />',f+='<input type="submit" class="button alt" value="'+woocommerce_help_scout_myaccount_params.send+'" />',f+="</p>",f+="</form>",e.fadeOut(500,function(){a(this).empty().show().prepend(f)}),c()}),a("body").on("submit","#support-conversation-reply",function(c){c.preventDefault();var d=a("#support-conversation-wrap"),e=a("#support-conversation-reply"),f=a("#support-conversation-thread-head");b(woocommerce_help_scout_myaccount_params.processing),a.ajax({type:"POST",url:woocommerce_help_scout_myaccount_params.ajax_url,cache:!1,dataType:"json",data:{conversation_id:a('input[name="conversation_id"]',e).val(),conversation_message:a('textarea[name="conversation_message"]',e).val(),user_id:a('input[name="user_id"]',e).val(),action:"wc_help_scout_create_thread",security:woocommerce_help_scout_myaccount_params.security},success:function(b){if(a.unblockUI(),null!==b&&1===b.error)a(".woocommerce-error, form",d).remove(),f.after('<div class="woocommerce-message">'+b.message+"</div>");else{var c=woocommerce_help_scout_myaccount_params.error;null!==b&&null!==b.message&&""!==b.message&&(c=b.message),a(".woocommerce-error",d).remove(),f.after('<div class="woocommerce-error">'+c+"</div>")}},error:function(){a.unblockUI(),a(".woocommerce-error",d).remove(),f.after('<div class="woocommerce-error">'+woocommerce_help_scout_myaccount_params.error+"</div>")}})})})}(jQuery);