!function(n){"use strict";if("undefined"==typeof wc_instagram_product_catalog_params)return;({$body:n("body"),$deleteLink:null,formFields:{},autoUpdateSlug:!0,init:function(){var t=this.getFormField("slug").val();this.autoUpdateSlug=""===t,this.toggleFormFields("slug",""!==t),n(".wc-instagram-field-editable-url").wc_instagram_editable_url(),wc_instagram_product_catalog_params.delete_link&&(this.$deleteLink=n(wc_instagram_product_catalog_params.delete_link),n("#mainform .woocommerce-save-button").after(this.$deleteLink)),this.initGoogleProductCategorySelects(),this.bindEvents()},bindEvents:function(){var o=this;this.getFormField("title").keyup(function t(i,o,n){var c;return function(){var t=this,e=arguments,a=n&&!c;clearTimeout(c),c=setTimeout(function(){c=null,n||i.apply(t,e)},o),a&&i.apply(t,e)}}(function(){o.autoUpdateSlug&&o.refreshCatalogSlug(n(this).val())},1e3,!1)),this.getFormField("slug").on("wc_instagram_editable_url_change",function(t,e){o.refreshCatalogSlug(e)}),this.$body.on("wc_instagram_product_catalog_slug_updated",function(t,e){o.autoUpdateSlug=o.autoUpdateSlug&&""===e,o.toggleFormFields("slug",!0),o.getFormField("slug").val(e).change()}),this.$body.on("wc_instagram_subset_values_updated",function(t,e,a){var i=!1;"product_types"===e&&(i=o.inSubset("variable",a),o.toggleFormFields(["virtual_products","downloadable_products"],o.inSubset("simple",a)),o.toggleFormFields("include_variations",i),o.toggleFormFields(["product_group_id","variation_description_field"],i&&o.getFormField("include_variations").prop("checked")))}),this.getFormField("include_variations").change(function(){var t=n(this).prop("checked");o.toggleFormFields("product_group_id",t),o.toggleFormFields("variation_description_field",t)}).change(),this.getFormField("product_mpn").change(function(){o.toggleFormFields("custom_mpn","custom"===n(this).val())}).change(),this.getFormField("include_tax").change(function(){o.toggleFormFields("tax_country","base"!==wc_instagram_product_catalog_params.tax_based_on&&n(this).prop("checked"))}).change(),this.$deleteLink&&this.$deleteLink.click(function(t){if(!window.confirm(n(this).data("confirm")))return t.preventDefault(),!1}),n(".form-table").on("change",".wc-instagram-gpc-select",function(){o.loadCategorySelect(n(this).val())})},getFormField:function(t){return this.formFields[t]||(this.formFields[t]=n("#"+t)),this.formFields[t]},toggleFormFields:function(t,a){var i=this;n.isArray(t)||(t=[t]),n.each(t,function(t,e){i.getFormField(e).closest("tr").toggle(a)})},refreshCatalogSlug:function(t){var e=this;t&&n.post({url:wc_instagram_product_catalog_params.ajax_url,data:{action:"wc_instagram_generate_product_catalog_slug",catalog_id:wc_instagram_product_catalog_params.catalog_id,catalog_title:t},dataType:"json",success:function(t){t.success&&e.$body.trigger("wc_instagram_product_catalog_slug_updated",t.data.slug)}})},inSubset:function(t,e){return""===e.option||"specific"===e.option&&-1!==e.values.indexOf(t)||"all_except"===e.option&&-1===e.values.indexOf(t)},initGoogleProductCategorySelects:function(){n(".wc-instagram-gpc-select:not(.select2-hidden-accessible)").select2({width:"auto"})},updateHiddenInput:function(t){n("#product_google_category").val(t)},loadCategorySelect:function(e){var a=this;e||n(".wc-instagram-gpc-select").each(function(){var t=n(this).val();if(""===t)return!1;e=t}),this.updateHiddenInput(e),n.post(window.wc_instagram_product_catalog_params.ajax_url,{action:"refresh_google_product_category_field",_wpnonce:window.wc_instagram_product_catalog_params.nonce,catalog_id:window.wc_instagram_product_catalog_params.catalog_id,category_id:e}).done(function(t){if(t.success){var e=n(".wc-instagram-gpc-select").first().closest("tr");e.length&&(e.replaceWith(t.data.output),a.initGoogleProductCategorySelects())}})}}).init()}(jQuery);