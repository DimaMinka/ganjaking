jQuery(function(i){var e=i("#woocommerce-pinterest-catalog-updating-frequency-days").parents("tr"),t=i("#woocommerce_pinterest_enable_catalog_auto_updating"),o=i("#woocommerce-pinterest-google-catalog-table"),n=i("#woocommerce-pinterest-category-board-table");function c(e){e.parents("td").find(".woocommerce-pinterest-table-saved-message").show().delay(3e3).fadeOut()}i(document).on("click","button[data-var]",function(){var e=i(this);!function(e,t){var o=document.querySelector(e);if(!o)return;o.focus();var n=o.value,a=o.selectionStart;o.value=n.slice(0,a)+t+n.slice(a),a+=t.length,o.setSelectionRange(a,a)}(e.data("field"),e.data("var"))}),i(document).on("change",".woocommerce-pinterest-google-category-select",function(e){var t=i(e.target),o=t.val();t.nextAll("select").remove(),t.is(":last-of-type")&&t.parent("fieldset").children(".woocommerce-pinterest-google-categories-mapping").val(o),""!==o&&i.ajax({url:window.ajaxurl,method:"GET",dataType:"json",data:{action:premmerceSettings.get_google_categories_action,parentId:o,_ajax_nonce:premmerceSettings.get_google_categories_nonce},success:function(e){if(0<e.length){var o=t.clone().val("").empty();o.append(new Option(premmerceSettings.not_selected_option_name)),i.each(e,function(e,t){o.append(new Option(t.name,t.id))}),o.insertAfter(t)}}})}),i(document).on("click","#save-google-categories-table",function(e){e.preventDefault();var a=[];o.find("input.woocommerce-pinterest-google-categories-mapping").each(function(e,t){var o=i(t),n=o.data("wc-category-id");a[n]=o.val()});var t=i(this);i.ajax({url:window.ajaxurl,method:"POST",dataType:"json",data:{action:premmerceSettings.save_google_categories_mapping_action,categories:a,_ajax_nonce:premmerceSettings.save_google_categories_mapping_nonce},success:function(e){e.success?c(t):alert("Error! Categories data wasn't saved.")}})}),i(document).on("click","#save-category-boards-table",function(e){e.preventDefault();var t=[];n.find("tbody tr").each(function(){var e=i(this),o={},n=e.find("[data-category-id]").attr("data-category-id");e.find(".woocommerce-pinterest-category-board-selectors .woocommerce-pinterest-board-select-container").each(function(e){var t=i(this);o[e]={cat_id:n,board_id:t.find(".woocommerce-pinterest-category-board-relations").val(),relation_id:t.find("[data-relations-id]").val()}}),t.push(o)});var o=i(this);i.ajax({url:window.ajaxurl,method:"POST",dataType:"json",data:{action:premmerceSettings.save_category_boards_relations_action,data:t,_ajax_nonce:premmerceSettings.save_category_boards_relations_nonce},success:function(e){e.success?c(o):alert("Error! Boards settings wasn't saved")}})}),i(document).on("click",".woocommerce-pinterest-category-board-new-select",function(e){e.preventDefault();var t=i(e.target).parent("td").find("fieldset").find(".woocommerce-pinterest-board-select-container"),o=t.first().clone();o.find("select").val(""),o.find("input").val("");var n=t.last(),a=new RegExp("^([^\\[]+\\[\\d+]\\[)(\\d+)(]\\[board_id])"),r=parseInt(n.find("select").attr("name").match(a)[2])+1,c=o.find("select").attr("name");c=c.replace(a,function(e,t,o,n,a,c){return[t,r,n].join("")}),o.find("select").attr("name",c),o.insertAfter(n)}),i(document).on("click",".woocommerce-pinterest-remove-board-select",function(e){e.preventDefault(),i(this).parents(".woocommerce-pinterest-board-select-container").remove()});var a=i("#woocommerce_pinterest_tags_fetching_strategy");a.select2(),i("ul.select2-selection__rendered").sortable({containment:"parent",update:function(e){i(e.target).children("li[title]").each(function(e,o){a.children("option").each(function(){i(o);if(i(this).html()==o.title){var e=i(this),t=e.parent();e.detach(),t.append(e)}})}),a.trigger("change")}}),e.toggle(t.is(":checked")),t.on("change",function(){e.toggle()}),i(document).on("click",".woocommerce-pinterest-copy-catalog-url-button",function(){i(".woocommerce-pinterest-catalog-url-field").select(),document.execCommand("copy")}),i("[name=woocommerce_pinterest_pin_time]").on("change",function(e){var t=[i("#woocommerce_pinterest_pin_defer_day").closest("tr"),i("#woocommerce_pinterest_pin_defer_time").closest("tr"),i("#woocommerce_pinterest_pin_defer_interval").closest("tr")];i("[name=woocommerce_pinterest_pin_defer_interval]").trigger("change"),"defer"===i(this).val()?t.forEach(function(e){e.show()}):t.forEach(function(e){e.hide()})}).trigger("change"),i("[name=woocommerce_pinterest_pin_defer_interval]").on("change",function(e){var t=[i("#woocommerce_pinterest_pin_defer_pins_per_interval").closest("tr")];"-1"===i(this).val()||"defer"!==i("[name=woocommerce_pinterest_pin_time]").val()?t.forEach(function(e){e.hide()}):t.forEach(function(e){e.show()})}).trigger("change"),i("[name=woocommerce_pinterest_pinterest_image_size_type]").on("change",function(e){var t=i("#pinterest_image_size-field");"pinterest_image"===i(this).val()?t.show():t.hide()}).trigger("change"),i(document).on("click","h3.wc-settings-sub-title",function(e){var t=i(this).toggleClass("closed"),o=t.prop("id").replace("woocommerce_pinterest_",""),n=t.hasClass("closed");i.ajax({url:window.ajaxurl,method:"POST",dataType:"json",data:{action:premmerceSettings.update_settings_page_boxes_states_action,sectionId:o,closed:n,_ajax_nonce:premmerceSettings.update_settings_page_boxes_states_nonce}})})});