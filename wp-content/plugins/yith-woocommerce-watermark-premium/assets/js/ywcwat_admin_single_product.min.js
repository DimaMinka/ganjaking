jQuery(document).ready(function(t){var a,e=t(".ywcwat_product_collapse"),i=t("#ywcwat_preview_image").dialog({resizable:!1,autoOpen:!1,height:"auto",width:400,modal:!0,buttons:{Ok:function(){t(this).dialog("close")}}}),o=function(t){return t.parents(".ywcwat_product_watermark_row").attr("id")},c=function(){t(".ywcwat_select_type_wat").on("change",function(a){var e=t(this),i=e.val(),c=t("#"+o(e)),r=c.find(".ywcwat_custom_wat_text_fields"),_=c.find(".ywcwat_custom_wat_img_fields"),l=c.find(".ywcwat_custom_general_fields");c.find(".position_select");switch(i){case"type_text":_.hide(),r.show(),l.show();break;case"type_img":_.show(),r.hide(),l.show();break;case"no":_.hide(),r.hide(),l.hide()}}).change(),t(document).on("click",".ywcwat_product_image",function(e){e.preventDefault();var i=t(this),c=t("#"+o(i));if(watermark_url=c.find(".ywcwat_product_wat_url"),watermark_id=c.find('input:hidden[id^="ywcwat_product_image_hidden-"]'),this_preview=c.find(".ywcwat_preview_watermark img"),table_position=c.find(".ywcwat_bottom_right"),a)a.open();else{var r=[new wp.media.controller.Library({library:wp.media.query({type:"image"}),multiple:!1,title:i.data("choose"),priority:20,filterable:"all"})];(a=wp.media.frames.downloadable_file=wp.media({title:i.data("choose"),library:{type:"image"},button:{text:i.data("choose")},multiple:!1,states:r})).on("select",function(){a.state().get("selection").map(function(t){(t=t.toJSON()).url&&(watermark_id.val(t.id),this_preview.attr("src",t.url),watermark_url.val(t.url),table_position.click())})}),a.open()}});var r=!1;t(document).on("click",".ywcwat_remove_product_watermark",function(a){if(a.preventDefault(),!r){var e=t(this).data("element_id");return window.confirm(ywcwat_product_param.delete_single_watermark.confirm_delete_watermark)&&(t("#ywcwat_product_watermark_row-"+e).remove(),c()),r=!0,!1}}),t(document).on("click",".product_ywcwat_container_position tr td",function(a){var e,i,o,c,r,_=t(this);i=(e=_).parent().parent(),o=i.parents(".position_table"),c=o.parent().find(".position_text"),r=o.find(".product_ywcwat_pos_value:eq(0)"),i.find("td").removeClass("position_select"),e.addClass("position_select"),e.hasClass("ywcwat_top_left")?(r.val("top_left"),c.html(ywcwat_product_param.label_position.top_left)):e.hasClass("ywcwat_top_center")?(r.val("top_center"),c.html(ywcwat_product_param.label_position.top_center)):e.hasClass("ywcwat_top_right")?(r.val("top_right"),c.html(ywcwat_product_param.label_position.top_right)):e.hasClass("ywcwat_middle_left")?(r.val("middle_left"),c.html(ywcwat_product_param.label_position.middle_left)):e.hasClass("ywcwat_middle_center")?(r.val("middle_center"),c.html(ywcwat_product_param.label_position.middle_center)):e.hasClass("ywcwat_middle_right")?(r.val("middle_right"),c.html(ywcwat_product_param.label_position.middle_right)):e.hasClass("ywcwat_bottom_left")?(r.val("bottom_left"),c.html(ywcwat_product_param.label_position.bottom_left)):e.hasClass("ywcwat_bottom_center")?(r.val("bottom_center"),c.html(ywcwat_product_param.label_position.bottom_center)):(r.val("bottom_right"),c.html(ywcwat_product_param.label_position.bottom_right))}),e.each(function(){t(this).toggleClass("expand").nextUntil(".ywcwat_product_collapse").slideToggle("slow")}),t(document).on("click",".ywcwat_product_collapse",function(){t(this).toggleClass("expand").nextUntil(".ywcwat_product_collapse").slideToggle("slow")}),t("#_ywcwat_product_enabled_watermark").is(":checked")?t(".show_if_custom_watermark_enabled").show():t(".show_if_custom_watermark_enabled").hide(),t(document).on("change","#_ywcwat_product_enabled_watermark",function(){t(this).is(":checked")?t(".show_if_custom_watermark_enabled").show():t(".show_if_custom_watermark_enabled").hide()}),t(document).on("click",".ywcwat_preview",function(a){a.preventDefault();var e=t(this).parents(".ywcwat_product_watermark_row").find("input, select, checkbox").serialize(),o={action:ywcwat_product_param.actions.preview_watermark,ywcwat_args:e,context:"product"};t.ajax({type:"POST",url:ywcwat_product_param.ajax_url,data:o,dataType:"json",success:function(a){a.result?t("#ywcwat_preview_image").find("img").attr("src",a.message).show():t("#ywcwat_preview_image").html("<p>"+a.message+"</p>"),i.dialog("open")}})}),t("#ywcwat_preview_image").on("dialogclose",function(a){t(this).find("img").attr("src","")})};t(document).on("click","#ywcwat_apply_product",function(a){a.preventDefault();var e=t(this),i={product_id:t(this).data("product_id"),action:ywcwat_product_param.actions.save_watermark_on_single_product};t.ajax({type:"POST",url:ywcwat_product_param.ajax_url,data:i,dataType:"json",beforeSend:function(){e.siblings(".ajax-loading").css("visibility","visible")},complete:function(){e.siblings(".ajax-loading").css("visibility","hidden")},success:function(t){}})}),t("body").on("ywcwat-product-init-fields",function(){c(),t(document).find(".product_ywcwat_container_position tr td.position_select").click(),t(document.body).trigger("wc-enhanced-select-init"),t(".product_colorpicker").wpColorPicker()}).trigger("ywcwat-product-init-fields")});