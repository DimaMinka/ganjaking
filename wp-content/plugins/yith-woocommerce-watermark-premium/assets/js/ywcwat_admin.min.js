jQuery(document).ready(function(a){var e=function(a,t){for(var e="",s=0,i=t.length;s<i;s++){var r=t[s],c=ywcwat_params.messages.error_messages[r[0]],o=ywcwat_params.messages.shop_sizes[r[1]];e+="<p>"+(ywcwat_params.messages.log_message+" "+a+" "+c+" "+ywcwat_params.messages.on+" "+o)+"</p>"}return e},s=0;a(document).on("click",".ywcwat_apply_all_watermark",function(t){t.preventDefault();var i=a(this),r=JSON.parse(ywcwat_params.attach_id),c=r.length,o=a("#ywcwat-progressbar_all"),n=a("#ywcwat-progressbar-percent_all"),l=a(".ywcwat_messages");o.parents("tr").show(),l.hide(),o.progressbar(),o.show(),s==c&&(n.html("0%"),s=0);i.prop("disabled",!0),function t(w){var _={ywcwat_attach_id:w,action:ywcwat_params.actions.apply_all_watermark};a.ajax({type:"POST",url:ywcwat_params.ajax_url,data:_,dataType:"json",success:function(_){if(s==c&&void 0===_.result)l.removeClass("complete_task").addClass("complete_all_task"),l.find(".ywcwat_icon").addClass("dashicons dashicons-yes"),l.find(".ywcwat_text").html(ywcwat_params.messages.complete_all_task),l.show(),i.prop("disabled",!1),o.hide();else{var d=e(w,_);a(".ywcwat_log_row td").show(),a("#ywcwat_log_container").append(d),o.progressbar("value",(s+1)/c*100),n.html(Math.round((s+1)/c*1e3)/10+"%"),s<c&&t(r[++s])}}})}(r[s])}),a(document).on("click","#ywcwat_reset_watermark",function(t){a(this);if(window.confirm(ywcwat_params.messages.reset_confirm)){var e={ywcwat_reset_watermark:"reset",action:ywcwat_params.actions.reset_watermark};a.ajax({type:"POST",url:ywcwat_params.ajax_url,data:e,dataType:"json",success:function(t){var e;a(".ywcwat_messages").addClass("complete_task"),a(".ywcwat_icon").addClass("dashicons dashicons-yes"),e=0==t.success||t.success>1?t.success+" "+ywcwat_params.messages.plural_success_image+", ":t.success+" "+ywcwat_params.messages.singular_success_image+", ",0==t.error||t.error>1?e+=t.error+" "+ywcwat_params.messages.plural_error_image+", ":e+=t.error+" "+ywcwat_params.messages.singular_error_image+", ",a(".ywcwat_text").html(e),a(".ywcwat_messages").show()}})}}),a(document).on("click","#ywcwat_show_log",function(t){t.preventDefault();var e=a(this).val(),s=a(this).data("hide_log");a(this).val(s).data("hide_log",e),a("#ywcwat_log_container").slideToggle("slow")}),a(document).on("click","#ywcwat_apply_product",function(e){e.preventDefault();var s={product_id:a(this).data("product_id"),action:ywcwat_params.actions.save_watermark_on_single_product};a.ajax({type:"POST",url:ywcwat_params.ajax_url,data:s,dataType:"json",beforeSend:function(){t.siblings(".ajax-loading").css("visibility","visible")},complete:function(){t.siblings(".ajax-loading").css("visibility","hidden")},success:function(a){}})});var i,r=a(".ywcwat-collapse"),c=ywcwat_params.block_loader,o=a("#ywcwat_preview_image").dialog({resizable:!1,autoOpen:!1,height:"auto",width:400,modal:!0,buttons:{Ok:function(){a(this).dialog("close")}}}),n=function(a){return a.parents(".ywcwat_row").attr("id")},l=function(){a(document).on("click",".ywcwat_load_image_watermark",function(t){t.preventDefault();var e=a(this),s=a("#"+n(e));if(watermark_url=s.find(".ywcwat_url"),watermark_id=s.find('input:hidden[id^="ywcwat_watermark_id-"]'),table_position=s.find(".ywcwat_bottom_right"),i)i.open();else{var r=[new wp.media.controller.Library({library:wp.media.query({type:"image"}),multiple:!1,title:e.data("choose"),priority:20,filterable:"all"})];(i=wp.media.frames.downloadable_file=wp.media({title:e.data("choose"),library:{type:"image"},button:{text:e.data("choose")},multiple:!1,states:r})).on("select",function(){i.state().get("selection").map(function(a){(a=a.toJSON()).url&&(watermark_id.val(a.id),watermark_url.val(a.url),table_position.click())})}),i.open()}}),a(".ywcwat_select_type_wat").on("change",function(t){var e=a(this),s=e.val(),i=a("#"+n(e)),r=i.find(".ywcwat_text_field_container"),c=i.find(".ywcwat_img_field_container"),o=i.find(".ywcwat_general_field_container");switch(s){case"type_text":c.hide(),r.show(),o.show();break;case"type_img":c.show(),r.hide(),o.show();break;case"no":c.hide(),r.hide(),o.hide()}}).change();var t=!1;a(document).on("click",".ywcwat_remove_watermark",function(e){if(e.preventDefault(),!t){var s=a(this).data("element_id");if(window.confirm(ywcwat_params.delete_single_watermark.confirm_delete_watermark)){var i=a("#ywcwat_row-"+s),r={ywcwat_unique_id:i.find("#ywcwat_id-"+s).val(),action:ywcwat_params.actions.remove_watermark};i.block({message:null,overlayCSS:{background:"#fff url("+c+") no-repeat center",opacity:.5,cursor:"none"}}),a.ajax({type:"POST",url:ywcwat_params.ajax_url,data:r,dataType:"json",success:function(t){a("#ywcwat_row-"+s).remove(),l()}}),t=!0}}return!1}),a(document).on("click",".ywcwat_container_position tr td",function(t){var e=a(this);w(e)}),a(document).on("click",".ywcwat_preview",function(t){t.preventDefault();var e=a(this),s=e.data("watermark_id"),i=e.parents(".ywcwat_field").find("input, select, checkbox").serialize(),r={ywcwat_id:s,action:ywcwat_params.actions.preview_watermark,ywcwat_args:i};a.ajax({type:"POST",url:ywcwat_params.ajax_url,data:r,dataType:"json",success:function(t){t.result?a("#ywcwat_preview_image").find("img").attr("src",t.message).show():a("#ywcwat_preview_image").html("<p>"+t.message+"</p>"),o.dialog("open")}})}),a("#ywcwat_preview_image").on("dialogclose",function(t){a(this).find("img").attr("src","")})},w=function(a){var t=a.parent().parent(),e=t.parents(".ywcwat_column_position"),s=e.find(".ywcwat_text_position"),i=e.find(".ywcwat_watermark_position:eq(0)");t.find("td").removeClass("position_select"),a.addClass("position_select"),a.hasClass("ywcwat_top_left")?(i.val("top_left"),s.html(ywcwat_params.label_position.top_left)):a.hasClass("ywcwat_top_center")?(i.val("top_center"),s.html(ywcwat_params.label_position.top_center)):a.hasClass("ywcwat_top_right")?(i.val("top_right"),s.html(ywcwat_params.label_position.top_right)):a.hasClass("ywcwat_middle_left")?(i.val("middle_left"),s.html(ywcwat_params.label_position.middle_left)):a.hasClass("ywcwat_middle_center")?(i.val("middle_center"),s.html(ywcwat_params.label_position.middle_center)):a.hasClass("ywcwat_middle_right")?(i.val("middle_right"),s.html(ywcwat_params.label_position.middle_right)):a.hasClass("ywcwat_bottom_left")?(i.val("bottom_left"),s.html(ywcwat_params.label_position.bottom_left)):a.hasClass("ywcwat_bottom_center")?(i.val("bottom_center"),s.html(ywcwat_params.label_position.bottom_center)):(i.val("bottom_right"),s.html(ywcwat_params.label_position.bottom_right))};r.each(function(){a(this).toggleClass("expand").nextUntil("tr.ywcwat-collapse").slideToggle("fast")}),a(document).on("click",".ywcwat-collapse",function(){a(this).toggleClass("expand").nextUntil("tr.ywcwat-collapse").slideToggle("fast")}),a("body").on("ywcwat-init-admin-fields",function(){l(),a(document).find(".ywcwat_container_position tr td.position_select").click(),a(document.body).trigger("wc-enhanced-select-init"),a(document.body).trigger("yith-framework-enhanced-select-init"),a(".ywcwat_color_picker").wpColorPicker()}).trigger("ywcwat-init-admin-fields")});